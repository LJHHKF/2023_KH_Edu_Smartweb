package dao;

import java.sql.Connection;
import java.sql.PreparedStatement;

import org.apache.commons.dbcp2.BasicDataSource;

import dto.MessagesDTO;

public class MessagesDAO {
	private String url = "jdbc:oracle:thin:@localhost:1521:xe";
	private String dbID = "board";
	private String dbPW = "board";
	private final BasicDataSource bds = new BasicDataSource();
	private final int poolSize = 5;
	
	public MessagesDAO(){
		super();
		this.init();
	}
	
	
	public MessagesDAO(String url, String dbID, String dbPW){
		super();
		this.url = url;
		this.dbID = dbID;
		this.dbPW = dbPW;
		this.init();
	}

	private void init() {
		bds.setUrl(url);
		bds.setUsername(dbID);
		bds.setPassword(dbPW);
		bds.setInitialSize(poolSize);
	}
	
	public int insert(MessagesDTO dto) throws Exception {
		String sql = "insert into MESSAGES(SEQ,WRITER,MESSAGE) values(SEQ_MESSAGES.nextval, ?, ?)";
		try(	Connection con = this.bds.getConnection();
				PreparedStatement pstat = con.prepareStatement(sql);){
			pstat.setString(1, dto.getWriter());
			pstat.setString(2, dto.getMessage());
			int result = pstat.executeUpdate();
			con.commit();
			return result;
		}
	}
}
