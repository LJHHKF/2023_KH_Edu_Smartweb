package dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import dto.MembersDTO;

public class MembersDAO {
	private String url = "jdbc:oracle:thin:@localhost:1521:xe";
	private String dbID = "kh";
	private String dbPW = "kh";
	
	public MembersDAO() throws Exception {
		super();
		Class.forName("oracle.jdbc.driver.OracleDriver");
	}
	
	public MembersDAO(String url, String dbID, String dbPW) throws Exception {
		super();
		Class.forName("oracle.jdbc.driver.OracleDriver");
		this.url = url;
		this.dbID = dbID;
		this.dbPW = dbPW;
	}
	
	private Connection createConnection() throws Exception {
		return DriverManager.getConnection(url, dbPW, dbID);
	}
	
	public int insert(MembersDTO dto) throws Exception{
		String sql = "insert into MEMBERS(ID, PW, NAME, CONTACT) values(?, ?, ?, ?)";
		try(	Connection con = this.createConnection();
				PreparedStatement pstat = con.prepareStatement(sql)){
			pstat.setString(1, dto.getId());
			pstat.setString(2, dto.getPw());
			pstat.setString(3, dto.getName());
			pstat.setString(4, dto.getContact());
			int result = pstat.executeUpdate();
			con.commit();
			return result;
		}
	}
	
	public boolean isLogin(String id, String pw) throws Exception {
		//PreparedStatement
		String sql = "select * from MEMBERS where ID = ? and PW = ?";
		try(	Connection con = this.createConnection();
				PreparedStatement pstat = con.prepareStatement(sql)){
			pstat.setString(1, id);
			pstat.setString(2, pw);
			try(ResultSet rs = pstat.executeQuery();) {
				return rs.next();
			}
		}

	}
}
