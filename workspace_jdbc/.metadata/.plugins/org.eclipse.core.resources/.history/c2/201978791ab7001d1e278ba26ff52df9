package dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;

import dto.MembersDTO;

public class MembersDAO {
//	private Connection con;
//	private Statement stat;
	private String url = "jdbc:oracle:thin:@localhost:1521:xe";
	private String dbID = "kh";
	private String dbPW = "kh";
	
	public MembersDAO() throws Exception {
		super();
		Class.forName("oracle.jdbc.driver.OracleDriver");
	}
	
	public MembersDAO(String url, String dbID, String dbPW) throws Exception {
		super();
		Class.forName("oracle.jdbc.driver.OracleDriver");
		this.url = url;
		this.dbID = dbID;
		this.dbPW = dbPW;
	}
	
	private Connection createConnection() throws Exception {
		return DriverManager.getConnection(url, dbPW, dbID);
	}
	
	public int insert(MembersDTO dto) throws Exception{
//		String sql = 
//				"insert into MEMBERS(ID, PW, NAME, CONTACT)"
//				+" values('"+ dto.getId() +"',"
//				+"'"+dto.getPw()+"',"
//				+"'"+dto.getName()+"',"
//				+"'"+dto.getContact()+"')";
//		try( 	Connection con = this.createConnection();
//				Statement stat = con.createStatement(); ){
//			int result = stat.executeUpdate(sql);
//			con.commit();
//			return result;
//		}
		//PreparedStatement
		String sql = "insert into MEMBERS(ID, PW, NAME, CONTACT) values(?, ?, ?, ?)";
		try(	Connection con = this.createConnection();
				PreparedStatement pstat = con.prepareStatement(sql)){
			pstat.setString(1, dto.getId());
			pstat.setString(2, dto.getPw());
			pstat.setString(3, dto.getName());
			pstat.setString(4, dto.getContact());
			int result = pstat.executeUpdate();
			con.commit();
			return result;
		}
	}
	
	public boolean isLogin(String id, String pw) throws Exception {
//		String sql = "select * from MEMBERS where ID = '" + id +"' and PW = '"+ pw +"'";
//		try(	Connection con = this.createConnection();
//				Statement stat = con.createStatement();
//				ResultSet rs = stat.executeQuery(sql); ){
//			return rs.next();
//		}

//		String sql = "select * from MEMBERS where ID = '" + id +"' and PW = '"+ pw +"'";
//		try(	Connection con = this.createConnection();
//				Statement stat = con.createStatement();
//				ResultSet rs = stat.executeQuery(sql); ){
//			while(rs.next()) {
//				if(rs.getString("ID").equals(id) && rs.getString("PW").equals(pw)) {
//					return true;
//				}
//			}
//			return false;
//		}
		
		//PreparedStatement
		String sql = "select * from MEMBERS where ID = ? and PW = ?";
		try(	Connection con = this.createConnection();
				PreparedStatement pstat = con.prepareStatement(sql)){
			pstat.setString(1, id);
			pstat.setString(2, pw);
			try(ResultSet rs = pstat.executeQuery();) {
				return rs.next();
			}
		}

	}
}
